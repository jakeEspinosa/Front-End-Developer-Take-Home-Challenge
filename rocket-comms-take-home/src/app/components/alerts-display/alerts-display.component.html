<rux-card>
  <div slot="header" class="flex">
    <span class="active-alerts">
      <span id="active-alerts-number">{{ currentAlerts().length }}</span>
      <span id="active-alerts-headline"
        >{{ isNewOrAck() === 'new' ? 'Active' : 'Acknowledged' }} Alerts</span
      >
    </span>
    <rux-select
      #statusSelect
      label="Status"
      input-id="status-select"
      label-id="status-select-label"
      name="status-select"
      size="medium"
      (ruxchange)="handleStatusSelection(statusSelect.value)"
    >
      <rux-option value="new" label="New" selected />
      <rux-option value="ack" label="Acknowledged" />
    </rux-select>
  </div>
  <div id="alerts-list">
    <div class="alert-row" id="alerts-list-header">
      <div class="alert-cell" id="message">Message</div>
      <div class="alert-cell" id="contact">Contact</div>
      <div class="alert-cell" id="time">Time</div>
    </div>
    <rux-accordion disallow-multiple="">
      @for (alert of currentAlerts(); track alert.key) {
        <rux-accordion-item>
          <div slot="label" class="alert-row">
            <div class="alert-cell message-status">
              <rux-status status="{{ alert.severity }}"></rux-status>
              <span>{{ alert.errorMessage }}</span>
            </div>
            <div class="alert-cell">
              {{ alert.contactName }}
            </div>
            <div class="alert-cell">
              {{ alert.timestamps.contactBeginTimestamp }} -
              {{ alert.timestamps.contactEndTimestamp }}
            </div>
          </div>

          <div class="accordion-item-content">
            {{ alert.errorMessage }}
            <rux-button icon="launch" (click)="showDialog(alert)">Show Details</rux-button>
          </div>
        </rux-accordion-item>
      }
    </rux-accordion>
    <rux-dialog [open]="isDialogOpen()" (ruxdialogclosed)="handleRuxDialogClosed($event)">
      <p class="dialog-contact">
        <span class="dialog-bold">Contact:</span>
        {{ dialogMessageContact() }}
      </p>

      <p>
        <span class="dialog-bold">Detail:</span>
        {{ dialogMessageDetail() }}
      </p>

      <div slot="footer">
        @let alert = selectedAlert();
        <div class="flex-space-between">
          @if (alert && !alert.acknowledged) {
            <rux-button (click)="acknowledgeAlert(alert.key); closeDialog()">
              Acknowledge
            </rux-button>
          }

          <rux-button secondary (click)="closeDialog()">Close</rux-button>
        </div>
      </div>
    </rux-dialog>
  </div>
</rux-card>
